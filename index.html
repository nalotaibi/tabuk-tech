<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-35NPHCGB93"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-35NPHCGB93');
    </script>

    <link rel="apple-touch-icon" href="1024.png">
    <link rel="icon" href="1024.png">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØºÙŠØ§Ø¨</title>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #006699;
            --secondary: #00aed9;
            --text-dark: #2c3e50;
            --safe: #22c55e;
            --warning: #facc15;
            --orange: #fb923c;
            --danger: #ef4444;
            --bg-gradient: linear-gradient(135deg, #e6f4f8 0%, #ffffff 100%);
            --info-modal-bg: #ffffff;
            --info-modal-text: #1f2937;
            --info-modal-accent: #0EA5E9;
        }

        .num{ direction: ltr; unicode-bidi: isolate; display: inline-block; font-weight: 800; }
        .formula-line{ direction: rtl; unicode-bidi: isolate-override; text-align: center; white-space: nowrap; }

        body { margin: 0; font-family: 'Cairo', sans-serif; background: var(--bg-gradient); padding: 20px 10px; direction: rtl; min-height: 100vh; }

        .install-banner { background: #ffffff; border: 1px solid #e1e9e7; padding: 4px 12px; border-radius: 14px; margin-bottom: 14px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 3px 8px rgba(0,0,0,0.03); }
        .install-text { font-weight: 600; color: var(--primary); font-size: 0.78rem; }
        .install-btn { background: var(--secondary); color: white; border: none; padding: 4px 12px; border-radius: 10px; font-size: 0.72rem; font-weight: bold; cursor: pointer; }

        .app-container { max-width: 450px; margin: 0 auto; }
        .header-section { text-align: center; margin-bottom: 20px; }
        .college-logo img { width: clamp(220px, 60vw, 300px); margin-bottom: 4px; filter: drop-shadow(0 3px 6px rgba(0,0,0,0.12)); }
        .header-text h1 { margin: 0; font-size: clamp(1.9rem, 4.8vw, 2.5rem); font-weight: 800; color: var(--primary); }

        .system-badge { display: inline-block; margin-top: 8px; padding: 4px 12px; background: #e0f2f1; color: #00796b; border-radius: 20px; font-size: 0.75rem; font-weight: bold; }

        /* Ø³ØªØ§ÙŠÙ„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†ÙØ³ Ø±ÙˆØ­ Ø§Ù„ÙƒÙˆØ¯ */
        .weeks-selector { margin: 15px 0; text-align: center; background: #fff; padding: 10px; border-radius: 15px; border: 1px solid #d1e2e8; }
        .weeks-selector label { font-weight: 800; color: var(--primary); font-size: 0.85rem; margin-left: 8px; }
        .weeks-selector select { width: auto; padding: 5px 10px; border-radius: 8px; border: 1.5px solid var(--secondary); font-weight: bold; color: var(--primary); }

        .action-bars { display: flex; gap: 10px; margin: 20px 0; }
        .add-btn { flex: 2; padding: 14px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; border: none; border-radius: 16px; font-weight: bold; cursor: pointer; font-size: 1.05rem; box-shadow: 0 4px 12px rgba(0, 102, 153, 0.2); }
        .reset-all { flex: 1; padding: 12px; background: #fff; color: var(--primary); border: 1px solid var(--primary); border-radius: 16px; cursor: pointer; font-weight: bold; }

        .course-card { background: white; border-radius: 28px; padding: 22px; margin-bottom: 20px; box-shadow: 0 12px 30px rgba(0,0,0,0.06); border: 1px solid #d1e2e8; position: relative; }
        .delete-course { position: absolute; top: 18px; left: 18px; background: #fee2e2; color: #ef4444; border: none; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .course-title { width: 85%; border: none; border-bottom: 2px solid #f0f0f0; font-size: 1.1rem; font-weight: bold; color: var(--primary); margin-bottom: 15px; padding: 5px; outline: none; background: transparent; }

        .input-group { margin-bottom: 12px; }
        .input-group label { display: block; font-size: 0.9rem; color: #334155; margin-bottom: 6px; font-weight: 800; background: #f0f7f9; padding: 6px 12px; border-right: 3px solid var(--secondary); }

        select, input { width: 100%; padding: 10px; border-radius: 12px; border: 1.5px solid #edf2f1; font-family: inherit; text-align: center; font-size: 0.95rem; outline: none; box-sizing: border-box; }

        .flex-inputs { display: flex; gap: 8px; align-items: flex-end; }
        .flex-inputs > div { flex: 1; }
        .input-sub-label { font-size: 0.8rem; color: #666; margin-bottom: 4px; display: flex; align-items: center; justify-content: center; gap: 2px; font-weight: 600; }

        .hint-icon, .info-icon { display: inline-flex; align-items: center; justify-content: center; width: 16px; height: 16px; background: #0EA5E9; color: white; border-radius: 50%; font-size: 0.75rem; cursor: pointer; font-weight: 900; }
        .info-icon.warn { background: var(--orange); }
        .info-icon.danger { background: var(--danger); }

        .result-area { border-radius: 20px; padding: 15px; margin-top: 15px; text-align: center; }
        .safe-bg { background: #f0fdf4; border: 1px solid #dcfce7; }
        .warning-bg { background: #fffbeb; border: 1px solid #fef3c7; }
        .danger-bg { background: #fef2f2; border: 1px solid #fee2e2; }

        .progress-bar { height: 8px; background: #e5e7eb; border-radius: 4px; margin: 10px 0; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; transition: 0.8s ease-in-out; }

        .advice-box { margin-top: 10px; padding-top: 10px; border-top: 1px dashed rgba(0,0,0,0.1); font-size: 0.85rem; color: #444; line-height: 1.4; }
        
        .info-overlay{ display:none; position:fixed; inset:0; background: rgba(15, 23, 42, 0.55); z-index: 10000; justify-content:center; align-items:center; padding: 14px; }
        .info-modal{ width: 92%; max-width: 360px; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 18px 45px rgba(0,0,0,0.25); }
        .info-modal-header{ display:flex; align-items:center; justify-content:space-between; padding: 14px 16px; border-bottom: 1px solid #eee; }
        .info-ok{ width:100%; background: var(--info-modal-accent); color: white; border: none; border-radius: 14px; padding: 12px; font-weight: 900; cursor: pointer; margin-top: 10px;}

        .footer-note { text-align: center; font-size: 0.8rem; color: #718096; margin-top: 40px; border-top: 1px solid #d1d9e6; padding-top: 20px; }
    </style>
</head>
<body>

<div id="guideModal" class="info-overlay" onclick="toggleModal(false)">
    <div class="info-modal" onclick="event.stopPropagation()">
        <div class="info-modal-header">
            <div style="font-weight:900;">ğŸ“± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</div>
            <button style="background:none; border:none; cursor:pointer;" onclick="toggleModal(false)">âœ•</button>
        </div>
        <div class="info-modal-body" style="padding:15px; text-align:center;">
            <b>iPhone:</b> Ù…Ø´Ø§Ø±ÙƒØ© â¬†ï¸ Ø«Ù… "Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"<br><br>
            <b>Android:</b> Ø®ÙŠØ§Ø±Ø§Øª â‹® Ø«Ù… "Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"
            <button class="info-ok" onclick="toggleModal(false)">ÙÙ‡Ù…Øª</button>
        </div>
    </div>
</div>

<div id="infoOverlay" class="info-overlay" onclick="closeInfoModal()">
    <div class="info-modal" onclick="event.stopPropagation()">
        <div class="info-modal-header">
            <div id="infoTitle" style="font-weight:900;">Ù…Ø¹Ù„ÙˆÙ…Ø©</div>
            <button style="background:none; border:none; cursor:pointer;" onclick="closeInfoModal()">âœ•</button>
        </div>
        <div class="info-modal-body" style="padding:15px;">
            <div id="infoText"></div>
            <div id="infoFormula" class="formula-line" style="display:none; background:#f0f7f9; padding:10px; border-radius:10px; margin-top:10px;"></div>
            <button class="info-ok" onclick="closeInfoModal()">ÙÙ‡Ù…Øª</button>
        </div>
    </div>
</div>

<div class="app-container">
    <div class="install-banner">
        <div class="install-text">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ÙƒØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ Ø§Ù„Ø°ÙƒÙŠ</div>
        <button class="install-btn" onclick="toggleModal(true)">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©</button>
    </div>

    <header class="header-section">
        <div class="college-logo"><img src="TVTC_identity.png" alt="Logo"></div>
        <div class="header-text">
            <h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø°ÙƒÙŠØ©</h1>
        </div>
    </header>

    <div class="weeks-selector">
        <label>Ù†Ø¸Ø§Ù… Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</label>
        <select id="weeksNum" onchange="updateWeeks(this.value)">
            <option value="16">16 Ø£Ø³Ø¨ÙˆØ¹Ø§Ù‹</option>
            <option value="15">15 Ø£Ø³Ø¨ÙˆØ¹Ø§Ù‹</option>
        </select>
    </div>

    <div class="action-bars">
        <button class="add-btn" onclick="addNewCourse()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø± Ø¬Ø¯ÙŠØ¯</button>
        <button class="reset-all" onclick="clearEverything()">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
    </div>

    <div id="coursesList"></div>

    <footer class="footer-note">
        <p style="font-weight:bold; color:var(--primary); margin:0;">ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: Ø£. Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø«Ø§Ù…ÙŠ</p>
        <p style="margin:4px 0; font-size:0.75rem;">Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ù„Ù„Ø¨Ù†Ø§Øª Ø¨ØªØ¨ÙˆÙƒ</p>
        <a href="mailto:norah.a@tvtc.gov.sa" style="text-decoration:none; color:#006699; font-size:0.8rem;">ğŸ“§ norah.a@tvtc.gov.sa</a>
    </footer>
</div>

<script>
    let courses = JSON.parse(localStorage.getItem('myCourses')) || [];
    let termWeeks = localStorage.getItem('termWeeks') || "16";
    document.getElementById('weeksNum').value = termWeeks;

    function updateWeeks(val) {
        termWeeks = val;
        localStorage.setItem('termWeeks', val);
        renderCourses();
    }

    function hourWord(n) {
        let v = Math.abs(parseFloat(n));
        if (v === 0) return "Ø³Ø§Ø¹Ø©";
        if (v >= 1 && v <= 2) return "Ø³Ø§Ø¹Ø©";
        if (v >= 3 && v <= 10) return "Ø³Ø§Ø¹Ø§Øª";
        return "Ø³Ø§Ø¹Ø©";
    }

    function getLectureText(n) {
        let v = Math.abs(n);
        if (v === 0) return "";
        if (v === 1) return "1 Ù…Ø­Ø§Ø¶Ø±Ø©";
        if (v === 2) return "2 Ù…Ø­Ø§Ø¶Ø±Ø©";
        return `${v} Ù…Ø­Ø§Ø¶Ø±Ø§Øª`;
    }

    function toggleModal(show) { document.getElementById('guideModal').style.display = show ? 'flex' : 'none'; }
    function closeInfoModal() { document.getElementById('infoOverlay').style.display = 'none'; }
    function fixNumbers(str) { return str.replace(/[Ù -Ù©]/g, d => d.charCodeAt(0) - 1632).replace(/[^\d.]/g, ''); }

    function openLimitInfo(weeklyH, limit) {
        const text = `ğŸ“˜ Ø­Ø³Ø§Ø¨ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø­Ø±Ù…Ø§Ù† (Ù†Ø¸Ø§Ù… ${termWeeks} Ø£Ø³Ø¨ÙˆØ¹):`;
        const formula = `(${weeklyH} Ã— ${termWeeks}) Ã— 20% = ${limit.toFixed(1)} Ø³Ø§Ø¹Ø©`;
        document.getElementById('infoTitle').textContent = 'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨';
        document.getElementById('infoText').innerHTML = text;
        const f = document.getElementById('infoFormula');
        f.style.display = 'block'; f.textContent = formula;
        document.getElementById('infoOverlay').style.display = 'flex';
    }

    function renderCourses() {
        const list = document.getElementById('coursesList');
        list.innerHTML = '';
        const W = parseInt(termWeeks);

        courses.forEach(course => {
            const weeklyH = parseFloat(course.weeklyHours) || 0;
            const limit = (weeklyH * W) * 0.20;
            const currentAbsent = (parseFloat(course.absent1) || 0) + ((parseFloat(course.absent2) || 0) * 2);
            const percent = (currentAbsent / (weeklyH * W)) * 100 || 0;
            const remaining = limit - currentAbsent;

            let statusClass = 'safe-bg', statusColor = 'var(--safe)', msg = 'ğŸŸ¢ ÙˆØ¶Ø¹Ùƒ Ø¢Ù…Ù† ÙˆÙ…Ø³ØªÙ‚Ø±';
            if (currentAbsent >= limit - 0.01) { statusClass = 'danger-bg'; statusColor = 'var(--danger)'; msg = 'ğŸ”´ Ø­Ø§Ù„Ø© Ø­Ø±Ù…Ø§Ù†'; }
            else if (percent >= 15) { statusClass = 'warning-bg'; statusColor = 'var(--orange)'; msg = 'ğŸŸ  ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù‚ØªØ±Ø¨Øª Ù…Ù† Ø§Ù„Ø­Ø±Ù…Ø§Ù†'; }
            else if (percent >= 10) { statusClass = 'warning-bg'; statusColor = 'var(--warning)'; msg = 'ğŸŸ¡ Ø§Ù†ØªØ¨Ø§Ù‡: Ø¨Ø¯Ø£ Ø±ØµÙŠØ¯Ùƒ Ø¨Ø§Ù„Ù†Ù‚ØµØ§Ù†'; }

            let advice = "";
            if (currentAbsent < limit - 0.01) {
                const remHours = Math.floor(remaining);
                let detail = "";
                if (weeklyH === 3 || weeklyH === 5) {
                    const l2 = Math.floor(remHours / 2), l1 = remHours % 2;
                    if (l2 > 0 && l1 > 0) detail = `${getLectureText(l2)} (Ø³Ø§Ø¹ØªÙŠÙ†) Ùˆ ${getLectureText(l1)} (Ø³Ø§Ø¹Ø©)`;
                    else if (l2 > 0) detail = `${getLectureText(l2)} (Ø³Ø§Ø¹ØªÙŠÙ†)`;
                    else if (l1 > 0) detail = `${getLectureText(l1)} (Ø³Ø§Ø¹Ø©)`;
                } else if (weeklyH === 1) {
                    detail = `${getLectureText(remHours)} (Ø³Ø§Ø¹Ø©)`;
                } else {
                    detail = `${getLectureText(Math.floor(remHours / 2))} (Ø³Ø§Ø¹ØªÙŠÙ†)`;
                }
                advice = `<div class="advice-box">Ù…ØªØ¨Ù‚ÙŠ Ù„Ùƒ <b>${remHours}</b> ${hourWord(remHours)}: ${detail}</div>`;
                if (remaining < (weeklyH === 1 ? 1 : 2)) advice += `<div style="color:var(--danger); font-size:0.7rem; font-weight:bold;">âš ï¸ Ø£ÙŠ ØºÙŠØ§Ø¨ Ù‚Ø§Ø¯Ù… Ø³ÙŠØ¤Ø¯ÙŠ Ù„Ù„Ø­Ø±Ù…Ø§Ù†</div>`;
            } else {
                advice = `<div class="advice-box" style="color:var(--danger); font-weight:bold;">ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­</div>`;
            }

            const isComplex = (weeklyH === 3 || weeklyH === 5);
            const card = document.createElement('div');
            card.className = 'course-card';
            card.innerHTML = `
                <button class="delete-course" onclick="deleteCourse(${course.id})">âœ•</button>
                <input type="text" class="course-title" value="${course.name}" onchange="updateCourse(${course.id}, 'name', this.value)">
                <div class="input-group">
                    <label>Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</label>
                    <select onchange="updateCourse(${course.id}, 'weeklyHours', this.value)">
                        ${[1,2,3,4,5,6].map(h => `<option value="${h}" ${weeklyH==h?'selected':''}>${h} Ø³Ø§Ø¹Ø©</option>`).join('')}
                    </select>
                </div>
                <div class="input-group">
                    <label>Ù…Ø±Ø§Øª Ø§Ù„ØºÙŠØ§Ø¨</label>
                    <div class="flex-inputs">
                        ${weeklyH >= 2 ? `<div>${isComplex?'<span class="input-sub-label">Ø³Ø§Ø¹ØªÙŠÙ†</span>':''}<input type="text" value="${course.absent2}" oninput="handleInput(${course.id}, 'absent2', this)"></div>` : ''}
                        ${(weeklyH==1||isComplex) ? `<div>${isComplex?'<span class="input-sub-label">Ø³Ø§Ø¹Ø©</span>':''}<input type="text" value="${course.absent1}" oninput="handleInput(${course.id}, 'absent1', this)"></div>` : ''}
                    </div>
                </div>
                <div class="result-area ${statusClass}">
                    <div style="font-weight:800; color:${statusColor}; margin-bottom:10px;">${msg}</div>
                    <div style="display:flex; justify-content:space-between; align-items:baseline;">
                        <span style="font-size:1.8rem; font-weight:900; color:var(--primary);">${percent.toFixed(1)}%</span>
                        <span style="font-size:0.85rem; color:#718096; font-weight:bold;">Ù…Ù† 20%</span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${Math.min((percent/20)*100, 100)}%; background:${statusColor}"></div></div>
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#555; font-weight:700;">
                        <span>ØºÙŠØ§Ø¨Ùƒ: ${currentAbsent} Ø³Ø§Ø¹Ø©</span>
                        <span>Ø§Ù„Ø­Ø¯: ${limit.toFixed(1)} <span class="info-icon" onclick="openLimitInfo(${weeklyH}, ${limit})">i</span></span>
                    </div>
                    ${advice}
                </div>`;
            list.appendChild(card);
        });
        localStorage.setItem('myCourses', JSON.stringify(courses));
    }

    function handleInput(id, field, el) { el.value = fixNumbers(el.value); updateCourse(id, field, el.value); }
    function updateCourse(id, field, value) {
        const idx = courses.findIndex(c => c.id === id);
        if (idx !== -1) {
            courses[idx][field] = value;
            if (field === 'weeklyHours') { courses[idx].absent1 = ''; courses[idx].absent2 = ''; }
            renderCourses();
        }
    }
    function addNewCourse() { courses.push({ id: Date.now(), name: 'Ù…Ù‚Ø±Ø± Ø¬Ø¯ÙŠØ¯', weeklyHours: 4, absent1: '', absent2: '' }); renderCourses(); }
    function deleteCourse(id) { if (confirm('Ø­Ø°ÙØŸ')) { courses = courses.filter(c => c.id !== id); renderCourses(); } }
    function clearEverything() { if (confirm('Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·ØŸ')) { courses = []; renderCourses(); } }
    window.onload = renderCourses;
</script>
</body>
</html>
