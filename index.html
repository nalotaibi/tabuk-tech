<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-35NPHCGB93"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-35NPHCGB93');
</script>

    <link rel="apple-touch-icon" href="1024.png">
    <link rel="icon" href="1024.png">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØºÙŠØ§Ø¨</title>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #006699;
            --secondary: #00aed9;
            --text-dark: #2c3e50;

            --safe: #22c55e;
            --warning: #facc15;
            --orange: #fb923c;
            --danger: #ef4444;

            --bg-gradient: linear-gradient(135deg, #e6f4f8 0%, #ffffff 100%);

       
            --info-modal-bg: #ffffff;
            --info-modal-text: #1f2937;
            --info-modal-accent: #0EA5E9;
        }

        .num{
            direction: ltr;
            unicode-bidi: isolate;
            display: inline-block;
            font-weight: 800;
        }

        .formula-line{
            direction: rtl;
            unicode-bidi: isolate-override;
            text-align: center;
            white-space: nowrap;
        }

        body {
            margin: 0;
            font-family: 'Cairo', 'Segoe UI', Tahoma, sans-serif;
            background: var(--bg-gradient);
            padding: 20px 10px;
            direction: rtl;
            min-height: 100vh;
        }

       .install-banner {
    background: #ffffff;
    border: 1px solid #e1e9e7;
    padding: 4px 12px;      
    border-radius: 14px;   
    margin-bottom: 14px;   
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 3px 8px rgba(0,0,0,0.03);
}


        .install-text {
    font-weight: 600;       
    color: var(--primary);
    font-size: 0.78rem;    
}


        .install-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 4px 12px; 
            border-radius: 10px;
            font-size: 0.72rem;
            font-weight: bold;
            cursor: pointer;
        }

        .app-container { max-width: 450px; margin: 0 auto; }
        .header-section { text-align: center; margin-bottom: 20px; }
        .college-logo img {
    width: clamp(220px, 60vw, 300px);
    margin-bottom: 0px;  
    filter: drop-shadow(0 3px 6px rgba(0,0,0,0.12));
}



  .header-text h1 {
    margin: 0;
    font-size: clamp(1.9rem, 4.8vw, 2.5rem); 
    font-weight: 800;
    color: var(--primary);
    letter-spacing: 0.3px;
}



        .system-badge {
            display: inline-block;
            margin-top: 8px;
            padding: 4px 12px;
            background: #e0f2f1;
            color: #00796b;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
        }


.system-16 {
    background: #ecfdf5;
    color: #047857;
}


.system-15 {
    background: #e0f2fe;
    color: #0369a1;
}


        .action-bars { display: flex; gap: 10px; margin: 20px 0; }
        .add-btn {
            flex: 2;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.05rem;
            letter-spacing: 0.3px;
            box-shadow: 0 4px 12px rgba(0, 102, 153, 0.2);
        }
        .reset-all {
            flex: 1;
            padding: 12px;
            background: #fff;
            color: var(--primary);
            border: 1px solid var(--primary);
            border-radius: 16px;
            cursor: pointer;
            font-weight: bold;
        }

        .course-card {
            background: white;
            border-radius: 28px;
            padding: 22px;
            margin-bottom: 20px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.06);
            border: 1px solid #d1e2e8;
            position: relative;
        }

        .delete-course {
            position: absolute;
            top: 18px;
            left: 18px;
            background: #fee2e2;
            color: #ef4444;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .course-title {
            width: 85%;
            border: none;
            border-bottom: 2px solid #f0f0f0;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
            padding: 5px;
            outline: none;
            background: transparent;
        }

        .input-group { margin-bottom: 12px; }
        .input-group label {
    display: block;
    font-size: 0.9rem;          
    color: #334155;
    margin-bottom: 6px;
    font-weight: 800;         
    background: #f0f7f9;
    padding: 6px 12px;         
    border-right: 3px solid var(--secondary);
}


        select, input {
            width: 100%;
            padding: 10px;
            border-radius: 12px;
            border: 1.5px solid #edf2f1;
            font-family: inherit;
            text-align: center;
            font-size: 0.95rem;
            outline: none;
            box-sizing: border-box;
            transition: all 0.3s;
        }

        input:focus { border-color: var(--secondary); background: #f8fdff; }
        .flex-inputs { display: flex; gap: 8px; align-items: flex-end; }
        .flex-inputs > div { flex: 1; }

        .input-sub-label {
    font-size: 0.8rem;
    color: #666;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2px;
    font-weight: 600;
}

        .hint-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    background: #0EA5E9;
    color: white;
    border-radius: 50%;
    font-size: 0.75rem;
    margin-right: 6px;
    cursor: pointer;
    font-weight: 900;
    vertical-align: middle;
    box-shadow: 0 6px 14px rgba(14,165,233,0.22);
    transition: transform 0.15s ease;

    order: 2;   
}
        .hint-icon:active { transform: translateY(1px) scale(0.98); }

        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: var(--info-modal-accent);
            color: white;
            border-radius: 999px;
            font-size: 0.78rem;
            margin-right: 6px;
            cursor: pointer;
            font-weight: 900;
            vertical-align: middle;
            box-shadow: 0 6px 14px rgba(14,165,233,0.25);
            transition: transform 0.15s ease, filter 0.15s ease, background 0.2s ease;
        }
        .info-icon:hover { filter: brightness(1.05); }
        .info-icon:active { transform: translateY(1px) scale(0.98); }
        .info-icon.warn { background: var(--orange); box-shadow: 0 6px 14px rgba(251,146,60,0.25); }
        .info-icon.danger { background: var(--danger); box-shadow: 0 6px 14px rgba(239,68,68,0.25); }

        .result-area { border-radius: 20px; padding: 15px; margin-top: 15px; text-align: center; }
        .safe-bg { background: #f0fdf4; border: 1px solid #dcfce7; }
        .warning-bg { background: #fffbeb; border: 1px solid #fef3c7; }
        .danger-bg { background: #fef2f2; border: 1px solid #fee2e2; }

        .progress-bar { height: 8px; background: #e5e7eb; border-radius: 4px; margin: 10px 0; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; transition: 0.8s ease-in-out; }

        .advice-box {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed rgba(0,0,0,0.1);
            font-size: 0.85rem;
            color: #444;
            line-height: 1.4;
        }
        .advice-box b { color: var(--primary); }

        .footer-note {
            text-align: center;
            font-size: 0.8rem;
            color: #718096;
            margin-top: 40px;
            border-top: 1px solid #d1d9e6;
            padding-top: 20px;
        }
        .footer-note p {
    margin: 3px 0;
}

        .footer-note .year {
    font-size: 0.7rem;
    color: #888;
}

        .primary-num {
    color: var(--primary);
    font-weight: 900;
}
 /* ØªÙˆØ­ÙŠØ¯ Ø­Ø¬Ù… Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… + Ø§Ù„Ù…Ø¯Ø© + Ø§Ù„ØºÙŠØ§Ø¨ */
.flex-inputs select,
.flex-inputs input {
  height: 42px;
  padding: 10px;
  border-radius: 12px;
  box-sizing: border-box;
  text-align: center;
  text-align-last: center;
}


        /* ===== Info Modal (Ù…ÙˆØ­Ù‘Ø¯ Ù„Ù„Ø¬Ù…ÙŠØ¹) ===== */
        .info-overlay{
            display:none;
            position:fixed;
            inset:0;
            background: rgba(15, 23, 42, 0.55);
            z-index: 10000;
            justify-content:center;
            align-items:center;
            padding: 14px;
        }

        .info-modal{
            width: 92%;
            max-width: 360px;
            background: var(--info-modal-bg);
            color: var(--info-modal-text);
            border-radius: 20px;
            box-shadow: 0 18px 45px rgba(0,0,0,0.25);
            overflow: hidden;
            border: 1px solid rgba(15, 23, 42, 0.08);
        }

        .info-modal-header{
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding: 14px 16px;
            border-bottom: 1px solid rgba(15, 23, 42, 0.08);
        }

        .info-modal-title{
            display:flex;
            align-items:center;
            gap:10px;
            font-weight: 900;
            font-size: 0.95rem;
        }

        .info-badge{
            width: 28px;
            height: 28px;
            border-radius: 10px;
            display:flex;
            align-items:center;
            justify-content:center;
            background: #e0f2fe;
            color: var(--info-modal-accent);
            font-weight: 900;
        }

        .info-close{
            background: transparent;
            border: none;
            color: #475569;
            font-size: 1.1rem;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 10px;
        }
        .info-close:hover{
            background: rgba(2, 132, 199, 0.08);
            color: var(--info-modal-text);
        }

        .info-modal-body{
            padding: 14px 16px 6px 16px;
            font-size: 0.92rem;
            line-height: 1.7;
        }

        .info-modal-footer{
            padding: 12px 16px 16px 16px;
        }

        .info-ok{
            width:100%;
            background: var(--info-modal-accent);
            color: white;
            border: none;
            border-radius: 14px;
            padding: 12px 14px;
            font-weight: 900;
            cursor: pointer;
            box-shadow: 0 12px 28px rgba(0,0,0,0.12);
        }
        .info-ok:active{ transform: translateY(1px); }
    </style>
</head>

<body>

<!--  Guide Modal (Ù…ØµØ­Ø­: Ø¥ØºÙ„Ø§Ù‚ divs + Ø¥Ø¶Ø§ÙØ© Android + Ù…Ø­Ø§Ø°Ø§Ø© ÙˆØ³Ø· + Ø®Ø· Ø£ØµØºØ±) -->
<div id="guideModal" class="info-overlay" onclick="toggleModal(false)">
    <div class="info-modal" onclick="event.stopPropagation()">
        <div class="info-modal-header">
            <div class="info-modal-title">
                <span class="info-badge">ğŸ“±</span>
                <span>Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </div>
            <button class="info-close" onclick="toggleModal(false)">âœ•</button>
        </div>

        <div class="info-modal-body" style="text-align:center;">
            <div style="font-weight:900; color:var(--primary); margin-bottom:8px;">
                ğŸ Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠ iPhone (Safari)
            </div>
            <div style="font-size:0.82rem; line-height:1.7;">
                Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© â¬†ï¸<br>
                Ø«Ù… Ø§Ø®ØªØ±<br>
                <b style="color:var(--info-modal-accent)">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</b>
            </div>

            <hr style="border:none; border-top:1px solid rgba(15,23,42,0.10); margin:14px 0;">

            <div style="font-weight:900; color:var(--primary); margin-bottom:8px;">
                ğŸ¤– Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Android (Chrome)
            </div>
            <div style="font-size:0.82rem; line-height:1.7;">
                Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø«Ù„Ø§Ø« â‹®<br>
                Ø«Ù… Ø§Ø®ØªØ±<br>
                <b style="color:var(--info-modal-accent)">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</b>
            </div>
        </div> <!--  Ø¥ØºÙ„Ø§Ù‚ body -->

        <div class="info-modal-footer">
            <button class="info-ok" onclick="toggleModal(false)">ÙÙ‡Ù…Øª</button>
        </div>
    </div>
</div>

<!--  Info Modal Ù…ÙˆØ­Ù‘Ø¯ -->
<div id="infoOverlay" class="info-overlay" onclick="closeInfoModal()">
    <div class="info-modal" onclick="event.stopPropagation()">
        <div class="info-modal-header">
            <div class="info-modal-title">
                <span class="info-badge" id="infoBadge">i</span>
                <span id="infoTitle">Ù…Ø¹Ù„ÙˆÙ…Ø©</span>
            </div>
            <button class="info-close" onclick="closeInfoModal()">âœ•</button>
        </div>

        <div class="info-modal-body">
            <div id="infoText"></div>
            <div id="infoFormula" class="info-formula" style="display:none;"></div>
        </div>

        <div class="info-modal-footer">
            <button class="info-ok" onclick="closeInfoModal()">ÙÙ‡Ù…Øª</button>
        </div>
    </div>
</div>

<div class="app-container">
    <div class="install-banner">
        <div class="install-text">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ø³Ø¨Ø© ÙƒØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ Ø§Ù„Ø°ÙƒÙŠ</div>
        <button class="install-btn" onclick="toggleModal(true)">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©</button>
    </div>

    <header class="header-section">
        <div class="college-logo"><img src="TVTC_identity.png" alt="Logo"></div>
        <div class="header-text">
            <h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø°ÙƒÙŠØ©</h1>

        </div>
    </header>

    <div class="action-bars">
        <button class="add-btn" onclick="addNewCourse()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø± Ø¬Ø¯ÙŠØ¯</button>
        <button class="reset-all" onclick="clearEverything()">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
    </div>

    <div id="coursesList"></div>

    <footer class="footer-note">
        <div style="display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <p style="font-weight:bold; color:var(--primary); margin:0;">
ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: Ø£. Ù†ÙˆØ±Ø© Ø§Ù„Ù‚Ø«Ø§Ù…ÙŠ
</p>

<p style="margin:4px 0 0; font-size:0.75rem; color:#555;">
Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ù„Ù„Ø¨Ù†Ø§Øª Ø¨ØªØ¨ÙˆÙƒ
</p>
<p style="margin:0 0 4px; font-size:0.72rem; color:#777;">
Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ø³Ø¨ ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
</p>

<p class="year">1447Ù‡Ù€ | 2026Ù…</p>

<a href="mailto:norah.a@tvtc.gov.sa"
   style="text-decoration:none; color:#006699; font-size:0.8rem; cursor:pointer;">
ğŸ“§&nbsp; norah.a@tvtc.gov.sa
</a>

        </div>
    </footer>
</div>

<script>
    let courses = JSON.parse(localStorage.getItem('myCourses')) || [];
    const selectedWeeks = 16; // ğŸ”’ Ø«Ø§Ø¨Øª (Ù„Ù„ØªÙˆØ§ÙÙ‚ ÙÙ‚Ø·) â€” Ø§Ù„Ø­Ø³Ø§Ø¨ ØµØ§Ø± Ø¨Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ

    // Ù…Ø³Ø§Ø¹Ø¯: Ø¬Ù„Ø¨ Ø¹Ù†ØµØ± Ø¨Ø£Ù…Ø§Ù†
    function $(id){ return document.getElementById(id); }
    // ==================
// âœ… Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (Ø«Ø§Ø¨Øª)
// ==================
const TERM_START = parseDMY('18-1-2026');
const TERM_END   = parseDMY('21-5-2026');

// Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© (ØªÙˆØ§Ø±ÙŠØ® ØªÙØ­Ø°Ù Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)
const HOLIDAYS = new Set([
  '22-2-2026',
  '22-3-2026',
  '23-3-2026',
  '24-3-2026'
].map(normDMYKey));

// ÙØ¬ÙˆØ© Ø®Ø§Ø±Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ (Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©)
const GAP_START = parseDMY('6-3-2026');
const GAP_END   = parseDMY('21-3-2026');

const WEEKDAY_INDEX = {
  'Ø§Ù„Ø£Ø­Ø¯': 0,
  'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': 1,
  'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': 2,
  'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': 3,
  'Ø§Ù„Ø®Ù…ÙŠØ³': 4,
  'Ø§Ù„Ø¬Ù…Ø¹Ø©': 5,
  'Ø§Ù„Ø³Ø¨Øª': 6
};

function parseDMY(dmy){
  // dmy: "18-1-2026" Ø£Ùˆ "18-01-2026"
  const [d,m,y] = String(dmy).split('-').map(Number);
  return new Date(y, (m||1)-1, d||1, 12, 0, 0); // 12:00 Ù„ØªÙØ§Ø¯ÙŠ Ù…Ø´Ø§ÙƒÙ„ DST
}

function normDMYKey(dmy){
  const [d,m,y] = String(dmy).split('-').map(Number);
  return `${d}-${m}-${y}`;
}

function dateToDMYKey(dt){
  return `${dt.getDate()}-${dt.getMonth()+1}-${dt.getFullYear()}`;
}

function inRange(dt, a, b){
  const t = dt.getTime();
  return t >= a.getTime() && t <= b.getTime();
}

function isExcludedDate(dt){
  const key = dateToDMYKey(dt);
  if (HOLIDAYS.has(key)) return true;
  if (inRange(dt, GAP_START, GAP_END)) return true;
  return false;
}

// Ø¹Ø¯Ù‘ ÙƒÙ… Ù…Ø±Ø© ÙŠØªÙƒØ±Ø± ÙŠÙˆÙ… (Ù…Ø«Ù„ Ø§Ù„Ø£Ø­Ø¯) Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ±Ù… ÙØ¹Ù„ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø­Ø°Ù Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª ÙˆØ§Ù„ÙØ¬ÙˆØ©
function countDayOccurrences(dayName){
  const target = WEEKDAY_INDEX[dayName];
  if (target === undefined) return 0;

  let count = 0;
  const cur = new Date(TERM_START.getTime());

  // Ù†ØªØ­Ø±Ùƒ ÙŠÙˆÙ…-Ø¨ÙŠÙˆÙ…
  while (cur.getTime() <= TERM_END.getTime()){
    if (cur.getDay() === target && !isExcludedDate(cur)) count++;
    cur.setDate(cur.getDate() + 1);
  }
  return count;
}


    //  ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© ØµÙŠØºØ© ÙƒÙ„Ù…Ø© (Ø³Ø§Ø¹Ø©/Ø³Ø§Ø¹Ø§Øª)
    function hourWord(n) {
        let v = Math.abs(parseFloat(n));
        if (v === 0) return "Ø³Ø§Ø¹Ø©";
        if (v >= 1 && v <= 2) return "Ø³Ø§Ø¹Ø©";
        if (v >= 3 && v <= 10) return "Ø³Ø§Ø¹Ø§Øª";
        return "Ø³Ø§Ø¹Ø©";
    }

    //  ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© ØµÙŠØºØ© ÙƒÙ„Ù…Ø© (Ù…Ø­Ø§Ø¶Ø±Ø©/Ù…Ø­Ø§Ø¶Ø±Ø§Øª)
    function getLectureText(n) {
    let v = Math.abs(n);
    if (v === 0) return "";
    if (v === 1) return `<b class="primary-num">1</b> Ù…Ø­Ø§Ø¶Ø±Ø©`;
    if (v === 2) return `<b class="primary-num">2</b> Ù…Ø­Ø§Ø¶Ø±Ø©`;
    if (v >= 3 && v <= 10) return `<b class="primary-num">${v}</b> Ù…Ø­Ø§Ø¶Ø±Ø§Øª`;
    return `<b class="primary-num">${v}</b> Ù…Ø­Ø§Ø¶Ø±Ø©`;
}

    function lectureRangeText(minL, maxL) {
        minL = Math.max(0, Math.floor(minL));
        maxL = Math.max(0, Math.floor(maxL));

        if (maxL <= 0) return "";
        if (minL === maxL) return getLectureText(minL);
        return `Ù…Ù† <b>${minL}</b> Ø¥Ù„Ù‰ <b>${maxL}</b> Ù…Ø­Ø§Ø¶Ø±Ø©`;
    }

    function toggleModal(show) {
        const modal = $('guideModal');
        if (!modal) return; // âœ… Ø­Ù…Ø§ÙŠØ©
        modal.style.display = show ? 'flex' : 'none';
    }

    function fixNumbers(str) {
        return String(str || '')
            .replace(/[Ù -Ù©]/g, function(d) { return d.charCodeAt(0) - 1632; })
            .replace(/[^\d.]/g, '');
    }

    function addNewCourse() {
  courses.push({
    id: Date.now(),
    name: 'Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø±Ø±',
    meetings: [
      { day: 'Ø§Ù„Ø£Ø­Ø¯', dur: 2, absent: '' }
    ]
  });
  renderCourses();
}


    function openInfoModal({title='Ù…Ø¹Ù„ÙˆÙ…Ø©', text='', formula='', badge='i'}) {
        const t = $('infoTitle'), tx = $('infoText'), b = $('infoBadge'), f = $('infoFormula'), ov = $('infoOverlay');
        if (!t || !tx || !b || !f || !ov) return; // âœ… Ø­Ù…Ø§ÙŠØ©

        t.textContent = title;
        tx.innerHTML = text;
        b.textContent = badge;

        if (formula && formula.trim() !== '') {
            f.style.display = 'block';
            f.textContent = formula;
        } else {
            f.style.display = 'none';
            f.textContent = '';
        }
        ov.style.display = 'flex';
    }

    function closeInfoModal() {
        const ov = $('infoOverlay');
        if (!ov) return;
        ov.style.display = 'none';
    }

    function openHintTwoHours() {
        openInfoModal({
            title: 'Ù…Ø­Ø§Ø¶Ø±Ø© ÙØ¦Ø© Ø³Ø§Ø¹ØªÙŠÙ†',
            text: 'ğŸ’¡ ÙŠÙ‚ØµØ¯ Ø¨Ù‡Ø§ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø§Ù„ØªÙŠ ØªÙØ­Ø³Ø¨ <b>Ø¨Ø³Ø§Ø¹ØªÙŠÙ† ØºÙŠØ§Ø¨</b> Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠØ¨ Ø¹Ù†Ù‡Ø§ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©.',
            badge: 'ğŸ’¡'
        });
    }

    function openHintOneHour() {
        openInfoModal({
            title: 'Ù…Ø­Ø§Ø¶Ø±Ø© ÙØ¦Ø© Ø³Ø§Ø¹Ø©',
            text: 'ğŸ’¡ ÙŠÙ‚ØµØ¯ Ø¨Ù‡Ø§ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø© Ø§Ù„ØªÙŠ ØªÙØ­Ø³Ø¨ <b>Ø¨Ø³Ø§Ø¹Ø© ØºÙŠØ§Ø¨ ÙˆØ§Ø­Ø¯Ø©</b> Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠØ¨ Ø¹Ù†Ù‡Ø§ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©.',
            badge: 'ğŸ’¡'
        });
    }

   function openLimitInfo(weeklyH, totalHours, limit) {
  const fixed = Number(limit).toFixed(1);
  const text = `
    <div style="font-weight:900; margin-bottom:6px; color:var(--primary);">
Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø±Ù…Ø§Ù† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ Ù„Ù„ÙØµÙ„ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ 1447 :
</div>

    <div style="margin-top:8px;">
      â€¢ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© (Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ù‚Ø§Ø¡Ø§Øª): <b class="num">${weeklyH}</b><br>
      â€¢ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ© ÙÙŠ Ø§Ù„ØªØ±Ù… (Ø¨Ø¹Ø¯ Ø­Ø°Ù Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©): <b class="num">${Number(totalHours).toFixed(1).replace(/\.0+$/,'')}</b> Ø³Ø§Ø¹Ø©
    </div>
    <div class="formula-line" style="margin-top:10px;">
      ( <span class="num">${Number(totalHours).toFixed(1).replace(/\.0+$/,'')}</span> Ø³Ø§Ø¹Ø© ) Ã— <span class="num">20%</span>
      = <span class="num">${fixed}</span> Ø³Ø§Ø¹Ø©
    </div>
  `;
  openInfoModal({ title: 'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨', text, badge: 'i', formula: '' });
}


    function ensureMeetings(course){
  if (!Array.isArray(course.meetings)) course.meetings = [];

  course.meetings = course.meetings.slice(0,3);

  if (course.meetings.length === 0) {
    course.meetings.push({ day:'Ø§Ù„Ø£Ø­Ø¯', dur:2, absent:'' });
  }

  course.meetings.forEach(m => {
    if (!m.day) m.day = 'Ø§Ù„Ø£Ø­Ø¯';
    m.dur = Number(m.dur) === 1 ? 1 : 2;
    if (m.absent === undefined) m.absent = '';
  });
}


function addMeeting(courseId){
  const i = courses.findIndex(c => c.id === courseId);
  if (i === -1) return;

  ensureMeetings(courses[i]);
  if (courses[i].meetings.length >= 3) return;

  courses[i].meetings.push({ day:'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', dur:1, absent:'' });
  renderCourses();
}

function removeMeeting(courseId){
  const i = courses.findIndex(c => c.id === courseId);
  if (i === -1) return;

  ensureMeetings(courses[i]);
  if (courses[i].meetings.length <= 1) return;

  courses[i].meetings.pop();
  renderCourses();
}


function updateMeeting(courseId, idx, field, value){
  const i = courses.findIndex(c => c.id === courseId);
  if (i === -1) return;

  ensureMeetings(courses[i]);

  const m = courses[i].meetings[idx];
  if (!m) return;

  if (field === 'day') m.day = value;
  if (field === 'dur') m.dur = Number(value) === 1 ? 1 : 2;
  if (field === 'absent') m.absent = fixNumbers(value);

  renderCourses();
}


    function renderCourses() {
  const list = $('coursesList');
  if (!list) return;
  list.innerHTML = '';

  const EPS = 1e-9;

  function fmt(n, digits = 1) {
    const x = Number(n);
    if (!Number.isFinite(x)) return '0';
    return x.toFixed(digits).replace(/\.0+$/, '');
  }

  courses.forEach(course => {
    // âœ… ØªØ£ÙƒÙŠØ¯ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù„Ù‚Ø§Ø¡Ø§Øª ÙˆØ¨Ù†ÙŠØ© absent Ù„ÙƒÙ„ Ù„Ù‚Ø§Ø¡
    ensureMeetings(course);

    // ==================
    // âœ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù„Ù‚Ø§Ø¡Ø§Øª
    // ==================
    const cleanMeetings = (course.meetings || []).slice(0, 3)
      .filter(m => m && m.day && (Number(m.dur) === 1 || Number(m.dur) === 2))
      .map(m => ({
        day: m.day,
        dur: Number(m.dur),
        absent: parseFloat(m.absent) || 0
      }));

    // Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© (Ù„Ù„Ø¹Ø±Ø¶)
    const weeklyH = cleanMeetings.reduce((s, m) => s + m.dur, 0);

    // ==================
    // âœ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø¨Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    // ==================
    const dayCountCache = {};
    function dayCount(dayName) {
      if (dayCountCache[dayName] === undefined) {
        dayCountCache[dayName] = countDayOccurrences(dayName);
      }
      return dayCountCache[dayName];
    }

    // Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ© ÙÙŠ Ø§Ù„ØªØ±Ù… = Î£ (Ø¹Ø¯Ø¯ Ù„Ù‚Ø§Ø¡Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ã— Ù…Ø¯Ø© Ø§Ù„Ù„Ù‚Ø§Ø¡)
    const totalHours = cleanMeetings.reduce((s, m) => s + (dayCount(m.day) * m.dur), 0);

    // Ø­Ø¯ Ø§Ù„Ø­Ø±Ù…Ø§Ù† 20%
    const limit = totalHours * 0.20;

    // Ø§Ù„ØºÙŠØ§Ø¨ Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª = Î£ (Ù…Ø±Ø§Øª ØºÙŠØ§Ø¨ Ø§Ù„Ù„Ù‚Ø§Ø¡ Ã— Ù…Ø¯Ø© Ø§Ù„Ù„Ù‚Ø§Ø¡)
    const currentAbsent = cleanMeetings.reduce((s, m) => s + (m.absent * m.dur), 0);

    const percent = totalHours ? (currentAbsent / totalHours) * 100 : 0;

    // Ø£Ù‚Ù„ ØºÙŠØ§Ø¨ Ù‚Ø§Ø¯Ù… Ù…Ø­ØªÙ…Ù„ = Ø£Ù‚Ù„ Ù…Ø¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© (1 Ø£Ùˆ 2)
    const minDur = cleanMeetings.length ? Math.min(...cleanMeetings.map(m => m.dur)) : 1;

    // ==================
    // âœ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù„ÙˆÙ†ÙŠØ©
    // ==================
    let statusClass = 'safe-bg',
      statusColor = 'var(--safe)',
      msg = 'ğŸŸ¢ ÙˆØ¶Ø¹Ùƒ Ø¢Ù…Ù† ÙˆÙ…Ø³ØªÙ‚Ø±',
      infoIconClass = '';

    if (currentAbsent + EPS >= limit) {
      statusClass = 'danger-bg';
      statusColor = 'var(--danger)';
      msg = 'ğŸ”´ Ø­Ø§Ù„Ø© Ø­Ø±Ù…Ø§Ù†';
      infoIconClass = 'danger';
    } else if (percent >= 15) {
      statusClass = 'warning-bg';
      statusColor = 'var(--orange)';
      msg = 'ğŸŸ  ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù‚ØªØ±Ø¨Øª Ù…Ù† Ø§Ù„Ø­Ø±Ù…Ø§Ù†';
      infoIconClass = 'warn';
    } else if (percent >= 10) {
      statusClass = 'warning-bg';
      statusColor = 'var(--warning)';
      msg = 'ğŸŸ¡ Ø§Ù†ØªØ¨Ø§Ù‡: Ø¨Ø¯Ø£ Ø±ØµÙŠØ¯Ùƒ Ø¨Ø§Ù„Ù†Ù‚ØµØ§Ù†';
      infoIconClass = 'warn';
    }

    // ==================
    // âœ… ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Øµ (Ù…ØªØ¨Ù‚ÙŠ/ØªØ­Ø°ÙŠØ±)
    // ==================
    let advice = '';

    if (currentAbsent + EPS >= limit) {
      advice = `<div class="advice-box" style="color:#dc2626; font-weight:900;">
                  ØªØ¬Ø§ÙˆØ²ØªÙ Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ (${fmt(limit, 1)} ${hourWord(limit)})
                </div>`;
    } else {
      const remainingSafeRaw = (limit - EPS) - currentAbsent;
      const nextStep = minDur; // 1 Ø£Ùˆ 2

      if (remainingSafeRaw <= EPS || remainingSafeRaw < nextStep - EPS) {
        advice = `
          <div class="advice-box" style="color:var(--danger); font-weight:900; text-align:center;">
            âš ï¸ Ø£ÙŠ ØºÙŠØ§Ø¨ Ù‚Ø§Ø¯Ù… Ø³ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø±Ù…Ø§Ù†
          </div>
        `;
      } else {
        const remInt = Math.max(0, Math.floor(remainingSafeRaw));

        // ØªÙØ§ØµÙŠÙ„ â€œÙƒÙ… Ù„Ù‚Ø§Ø¡ Ù…Ù…ÙƒÙ†â€ Ø­Ø³Ø¨ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© (Ø³Ø§Ø¹Ø©/Ø³Ø§Ø¹ØªÙŠÙ†)
        const has1 = cleanMeetings.some(m => m.dur === 1);
        const has2 = cleanMeetings.some(m => m.dur === 2);

        const remMeet1 = has1 ? Math.floor(remainingSafeRaw / 1) : 0;
        const remMeet2 = has2 ? Math.floor(remainingSafeRaw / 2) : 0;

        let detail = '';
        if (has1 && has2) detail = `${getLectureText(remMeet2)} (Ø³Ø§Ø¹ØªÙŠÙ†) + ${getLectureText(remMeet1)} (Ø³Ø§Ø¹Ø©)`;
        else if (has2) detail = `${getLectureText(remMeet2)} (Ø³Ø§Ø¹ØªÙŠÙ†)`;
        else detail = `${getLectureText(remMeet1)} (Ø³Ø§Ø¹Ø©)`;

        advice = `
          <div class="advice-box">
            Ù…ØªØ¨Ù‚ÙŠ Ù„Ùƒ <b>${fmt(remInt, 0)}</b> ${hourWord(remInt)}${detail ? `: ${detail}` : ''}
          </div>
        `;
      }
    }

    // ==================
    // âœ… Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    // ==================
    const card = document.createElement('div');
    card.className = 'course-card';

    card.innerHTML = `
      <button class="delete-course" onclick="deleteCourse(${course.id})">âœ•</button>

      <input type="text" class="course-title"
        value="${course.name}"
        onchange="updateCourse(${course.id}, 'name', this.value)">

      <div class="input-group">
        <label style="text-align:center;">Ù„Ù‚Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ù‚Ø±Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</label>

        <div id="meetWrap-${course.id}"></div>

        <div style="display:flex; gap:8px; margin-top:10px;">
          <button type="button" class="reset-all" style="flex:1;"
            onclick="addMeeting(${course.id})">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù‚Ø§Ø¡</button>
          <button type="button" class="reset-all" style="flex:1;"
            onclick="removeMeeting(${course.id})">â– Ø­Ø°Ù Ø¢Ø®Ø± Ù„Ù‚Ø§Ø¡</button>
        </div>

        <div style="margin-top:10px; font-size:0.82rem; color:#475569; font-weight:700; text-align:center;">
          Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©: <b class="primary-num">${weeklyH}</b> ${hourWord(weeklyH)}
        </div>
      </div>

      <div class="result-area ${statusClass}">
        <div style="font-size:0.95rem; font-weight:800; color:${statusColor}; margin-bottom:10px;">${msg}</div>

        <div style="display:flex; justify-content:space-between; align-items:baseline; margin-bottom:5px;">
          <span style="font-size:1.8rem; font-weight:900; color:var(--primary);">${fmt(percent, 1)}%</span>
          <span style="font-size:0.85rem; color:#718096; font-weight:bold;">Ù…Ù† Ø£ØµÙ„ 20%</span>
        </div>

        <div class="progress-bar">
          <div class="progress-fill" style="width:${Math.min((percent / 20) * 100, 100)}%; background:${statusColor}"></div>
        </div>

        <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#555; font-weight:700; margin-top:5px;">
          <span>ØºÙŠØ§Ø¨Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${fmt(currentAbsent, 1)} ${hourWord(currentAbsent)}</span>

          <span>
            Ø­Ø¯ Ø§Ù„Ø­Ø±Ù…Ø§Ù†: ${fmt(limit, 1)} ${hourWord(limit)}
            <span class="info-icon ${infoIconClass}" onclick="openLimitInfo(${weeklyH}, ${totalHours}, ${limit})">i</span>
          </span>
        </div>

        ${advice}
      </div>
    `;

    list.appendChild(card);

    // ==================
    // âœ… ØªØ¹Ø¨Ø¦Ø© ØµÙÙˆÙ Ø§Ù„Ù„Ù‚Ø§Ø¡Ø§Øª (Ø§Ù„ÙŠÙˆÙ… + Ø§Ù„Ù…Ø¯Ø© + Ø§Ù„ØºÙŠØ§Ø¨)
    // ==================
    const wrap = card.querySelector(`#meetWrap-${course.id}`);
    if (wrap) {
      wrap.innerHTML = (course.meetings || []).slice(0, 3).map((m, idx) => `
        <div class="flex-inputs" style="margin-top:8px;">
          <div>
            <div class="input-sub-label">Ø§Ù„ÙŠÙˆÙ…</div>
            <select onchange="updateMeeting(${course.id}, ${idx}, 'day', this.value)">
              ${['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'].map(d =>
                `<option value="${d}" ${(m.day === d) ? 'selected' : ''}>${d}</option>`
              ).join('')}
            </select>
          </div>

          <div>
            <div class="input-sub-label">Ø§Ù„Ù…Ø¯Ø©</div>
            <select onchange="updateMeeting(${course.id}, ${idx}, 'dur', this.value)">
              <option value="1" ${Number(m.dur) === 1 ? 'selected' : ''}>Ø³Ø§Ø¹Ø©</option>
              <option value="2" ${Number(m.dur) === 2 ? 'selected' : ''}>Ø³Ø§Ø¹ØªÙŠÙ†</option>
            </select>
          </div>

          <div>
            <div class="input-sub-label">Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„ØºÙŠØ§Ø¨</div>
            <input type="text" inputmode="numeric"
              value="${m.absent ?? ''}" placeholder="0"
              oninput="updateMeeting(${course.id}, ${idx}, 'absent', this.value)">
          </div>
        </div>
      `).join('');
    }
  });

  localStorage.setItem('myCourses', JSON.stringify(courses));
}

    function updateCourse(id, field, value) {
        const index = courses.findIndex(c => c.id === id);
        if (index !== -1) {
            courses[index][field] = value;
            renderCourses();
        }
    }
    function deleteCourse(id) { if (confirm('Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø±Ø±ØŸ')) { courses = courses.filter(c => c.id !== id); renderCourses(); } }
    function clearEverything() { if (confirm('Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) { courses = []; localStorage.removeItem('myCourses'); renderCourses(); } }

window.onload = function () {
  courses.forEach(c => ensureMeetings(c));
  renderCourses();
};

</script>
</body>
</html>
